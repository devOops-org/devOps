# 엘라스틱 서치 실무 가이드

## 1. 검색 시스템 이해하기
- 전체 흐름
    - 검색엔진으로서 엘라스틱 서치의 이해
    - 데이터의 모델링
    - 데이터의 검색 방법과 효율성 제고
    - 데이터를 그룹화하고 통계치를 얻는 집계
    - 엘라스틱 서치의 기반 기술인 루씬
    - 안정된 클러스터 운영

### [1.1 검색시스템의 이해](/docs/book/1.1_검색시스템의_이해.md)
### [1.2 검색 시스템과 엘라스틱서치](/docs/book/1.2_검색_시스템과_엘라스틱서치.md)
### [1.3 실습 환경 구축](/docs/book/1.3_실습_환경_구축.md)

## 2. 엘라스틱 서치 살펴보기

### [2.1 엘라스틱 서치를 구성하는 개념](/docs/book/2.1_엘라스틱_서치를_구성하는_개념.md)
### [2.2 엘라스틱서치에서 제공하는 주요 API](/docs/book/2.2_엘라스틱서치에서_제공하는_주요_API.md)

## 3. 데이터 모델링
- 색인 시 문서의 데이터 유형에 따라 필드에 적절한 데이터 타입을 지정하는 작업을 `매핑`이라 한다.
- 색인될 문서의 `데이터 모델링`이라고도 한다.
- 사전에 매핑을 설정하면 지정된 데이터 타입으로 색인되지만 매핑을 설정해 두지 않으면 엘라스틱서치가 자동으로 필드를 생성하고 필드 타입까지 결정한다.

### [3.1 매핑 API 이해하기](/docs/book/3.1_매핑_API_이해하기.md)
### [3.2 매핑 파라미터](/docs/book/3.2_매핑_파라미터.md)
### [3.3 매타 필드(Meta Fields)](/docs/book/3.3_매타_필드(Meta_Fields).md)
### [3.4 필드 데이터 타입](/docs/book/3.4_필드_데이터_타입.md)
### [3.5 엘라스틱 서치 분석기](/docs/book/3.5_엘라스틱서치_분석기.md)
### [3.6 Document API 이해하기](/docs/book/3.6_Document_API_이해하기.md)


## 4. 데이터 검색

## 5. 데이터 집계

## 6. 고급 검색

## 7. 한글 검색 확장 기능

## 8. 엘라스틱 서치 클라이언트
- 실무에서 엘라스틱서치에 접근할 때 전용 클라이언트 모듈을 많이 사용한다.
- 엘라스틱서치가 제공하는 `전용 클라이언트`를 사용해 `색인`이나 `검색 작업`을 수행할 방법을 알아보기로 한다.

### 8.1 엘라스틱서치 클라이언트 이해하기
> 클라이언트 모듈 종류
- HTTP 방식은 단 건의 요청을 처리하기에는 편리하지만 대량의 요청을 처리하기에는 적합하지 않다.
- 서비스로 검색 기능을 제공하기 위해서는 `다수의 요청에 빠르게 응답`해야 하기 때문에 일반적으로 서비스 개발에 사용한 `프로그래밍 언어에서 직접 사용할 수 있는 라이브러리 형태`를 선호한다.

> Java 클라이언트 모듈 두 가지
- Java REST Client
- Java API

> 자바 클라이언트 모듈
- 내부적으로 HTTP 방식으로 REST API를 사용해 접근하는 방식
- [네티(Netty)](https://netty.io/) 모듈을 이용해 네이티브 클라이언트를 통해 접근하는 방식
    - 네티란 고성능의 안정적인 서버 & 클라이언트를 개발할 수 있는 자바 기반의 프레임워크

- 클라이언트 간 방식 차이

|클라이언트 종류|설명|
|:---|:---|
|REST 클라이언트|- Java High Level REST Client라고도 불린다. <br> - HTTP 방식을 이용해 엘라스틱서치와 통신한다. <br> - 내부적으로는 HttpClient 모듈을 사용|
|Transport 클라이언트|- JavaClient 라고도 불린다. <br> - 초기부터 제공되던 클라이언트 방식으로, 상대적으로 빠른 속도를 보장한다. <br> - 소켓을 이용해 엘라스틱 서치와 통신한다. <br> - 내부적으로는 Netty 모듈을 사용한다.|

- Transport 클라이언트 도입의 문제점

```text
초기 버전의 엘라스틱 서치에서는 소켓을 이용하는 Transport 클라이언트만 제공, 
일종의 엘라스틱서치 노드와 비슷한 방식으로 동작하기 때문에 속도는 빠르지만 
엘라스틱 서치가 버전업 될때마다 제공되는 기능이나 API의 명세에 따라 클래스나 메서드가 바뀌는 문제점이 있다. 
```

- REST 클라이언트를 사용해야하는 이유
    - 내부적으로 HTTP 방식으로 동작하기 때문에 유연한 사용성을 제공한다.
    - 초기에는 기존 방식보다는 성능 측면에서 조금 떨어지는 부분이 있었지만 현재는 성능이 매우 좋아졌기 때문에 차이가 그리 나지 않는다.
    - 엘라스틱 7.0부터는 Transport 클라이언트가 deprecated 됐기 때문에 최신 버전의 엘라스틱 서치를 도입해야한다면 반드시 REST 클라이언트를 사용해야 한다.
    
```text
REST 클라이언트가 Transport 클라이언트에서 제공하는 모든 기능을 지원하지는 않기 때문에 실무에서는 두 가지 방식을 모두 활용해야 한다.
```

### 8.2 Transport 클라이언트
- 엘라스틱 서치 7.0에서 Transport 클아이언트 모듈은 미지원되고, 8.0에는 완전히 제거될 예정이므로 Java High Level REST 클라이언트를 사용하길 권장한다.

> Transport 클라이언트 연결
- Transport 클라이언트 모듈을 사용하기 위해서 라이브러리를 내려 받아야 한다.
```
// https://mvnrepository.com/artifact/org.elasticsearch.client/transport
compile group: 'org.elasticsearch.client', name: 'transport', version: '7.9.3'
```

- Transport 클라이언트는 내부적으로 소켓을 사용해 엘라스틱 서치 클러스터에 원격으로 연결된다.
- 연결 시 Settings 정보에 클러스터의 정보를 입력하면 클러스터로 연결된다.
- 연결을 위해서는 `IP 주소`와 `포트 번호`가 필요하다. 만약 포트 설정을 하지 않는 경우 기본 포트 값은 `9300`번 포트를 사용해 접속을 시도한다.

- 클라이언트 연결 예시

## 9. 엘라스틱서치와 루씬 이야기

## 10. 대용량 처리를 위한 시스템 최적화

## 11. 장애 방지를 위한 실시간 모니터링

## 12. 안정적인 클러스터 운영 노하우

## 13. 클러스터 성능 측정


